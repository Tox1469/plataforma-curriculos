<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal do Candidato</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-xl mx-auto bg-white shadow p-6 rounded">
    <h1 class="text-2xl font-bold mb-4">Bem-vindo, Candidato</h1>

    <form id="formCurriculo" class="space-y-4">
      <input type="text" name="nome" placeholder="Nome completo" class="w-full border p-2 rounded" required />
      <input type="text" name="cargo" placeholder="Último cargo" class="w-full border p-2 rounded" required />
      <input type="date" name="data_demissao" placeholder="Última demissão" class="w-full border p-2 rounded" required />
      <textarea name="outras_habilitacoes" placeholder="Outras habilitações" class="w-full border p-2 rounded"></textarea>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar Currículo</button>
    </form>

    <hr class="my-6">

    <form id="formUpload" enctype="multipart/form-data" class="space-y-4">
      <label class="block">Upload de documento (PDF, JPG, PNG):</label>
      <input type="file" name="documento" accept=".pdf,.jpg,.jpeg,.png" class="w-full" required />
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Enviar Documento</button>
    </form>
  </div>

  <script>
    // Proteção de acesso
    const token = localStorage.getItem('token');
    const userType = localStorage.getItem('tipo');
    if (!token || userType !== 'candidato') {
      alert("Acesso não autorizado");
      window.location.href = '/login.html';
    }

    // Salvar currículo
    document.getElementById('formCurriculo').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const body = {
        nome: form.nome.value,
        cargo: form.cargo.value,
        data_demissao: form.data_demissao.value,
        outras_habilitacoes: form.outras_habilitacoes.value
      };

      try {
        const res = await fetch('https://plataforma-curriculos.onrender.com/candidato/curriculo', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(body)
        });

        const data = await res.json();
        if (res.ok) {
          alert('✅ Currículo salvo com sucesso!');
        } else {
          alert('❌ Erro ao salvar: ' + (data.erro || 'Erro desconhecido'));
        }
      } catch (err) {
        alert('❌ Falha na requisição.');
      }
    });

    // Upload de documento
    document.getElementById('formUpload').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      const fileInput = document.querySelector('input[name="documento"]');
      formData.append('documento', fileInput.files[0]);

      try {
        const res = await fetch('https://plataforma-curriculos.onrender.com/candidato/upload', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData
        });

        const data = await res.json();
        if (res.ok) {
          alert('✅ Documento enviado com sucesso!');
        } else {
          alert('❌ Erro: ' + (data.erro || 'Erro desconhecido'));
        }
      } catch (err) {
        alert('❌ Erro na requisição.');
      }
    });
  </script>
</body>
</html>